<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Animated Continuous Sections with GSAP Observer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://public.codepenassets.com/css/normalize-5.0.0.min.css">
<link rel='stylesheet' href='https://codepen.io/GreenSock/pen/qEWKyrL.css'><link rel="stylesheet" href="./style.css">

  </head>
<body>
    <section class="second">
        <div class="outer">
          <div class="inner">
            <div class="bg">
              <h2 class="section-heading">Animated with GSAP</h2>
      
              <!-- Horizontal carousel (5 items). Each item fills the viewport width. -->
              <div class="carousel" aria-label="Horizontal carousel">
                <div class="carousel-track">
                  <div class="carousel-item item-1">
                    <div class="carousel-inner">
                      <h3>Item 1</h3>
                    </div>
                  </div>
                  <div class="carousel-item item-2">
                    <div class="carousel-inner">
                      <h3>Item 2</h3>
                    </div>
                  </div>
                  <div class="carousel-item item-3">
                    <div class="carousel-inner">
                      <h3>Item 3</h3>
                    </div>
                  </div>
                  <div class="carousel-item item-4">
                    <div class="carousel-inner">
                      <h3>Item 4</h3>
                    </div>
                  </div>
                  <div class="carousel-item item-5">
                    <div class="carousel-inner">
                      <h3>Item 5</h3>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end carousel -->
      
            </div>
          </div>
        </div>
      </section>    
</body>

<script>
    gsap.registerPlugin(Observer);

let sections = document.querySelectorAll("section"),
  images = document.querySelectorAll(".bg"),
  headings = gsap.utils.toArray(".section-heading"),
  outerWrappers = gsap.utils.toArray(".outer"),
  innerWrappers = gsap.utils.toArray(".inner"),
  splitHeadings = headings.map(heading => new SplitText(heading, { type: "chars,words,lines", linesClass: "clip-text" })),
  currentIndex = -1,
  // wrap removed to prevent infinite looping
  animating;

/* Carousel setup (section 2, zero-based index = 1) */
const carousel = document.querySelector('.carousel');
const carouselTrack = carousel ? carousel.querySelector('.carousel-track') : null;
const carouselItems = carousel ? gsap.utils.toArray('.carousel-item') : [];
let carouselIndex = 0;
let carouselAnimating = false;

gsap.set(outerWrappers, { yPercent: 100 });
gsap.set(innerWrappers, { yPercent: -100 });

/* set carousel instantly to a given index (if exists) */
function setCarouselToIndex(idx) {
  if (!carouselTrack) return;
  idx = Math.max(0, Math.min(idx, carouselItems.length - 1));
  gsap.set(carouselTrack, { xPercent: -100 * idx });
  carouselIndex = idx;
}

/* animate carousel to index */
function gotoCarousel(index, direction) {
  if (!carouselTrack) return;
  index = Math.max(0, Math.min(index, carouselItems.length - 1));
  if (index === carouselIndex) return;
  carouselAnimating = true;
  gsap.to(carouselTrack, {
    xPercent: -100 * index,
    duration: 0.9,
    ease: "power1.inOut",
    onComplete: () => {
      carouselAnimating = false;
    }
  });
  carouselIndex = index;
}

function gotoSection(index, direction) {
  // clamp / guard - no wrap-around
  if (index < 0 || index > sections.length - 1) {
    return;
  }

  animating = true;
  let fromTop = direction === -1,
      dFactor = fromTop ? -1 : 1,
      tl = gsap.timeline({
        defaults: { duration: 1.25, ease: "power1.inOut" },
        onComplete: () => animating = false
      });
  if (currentIndex >= 0) {
    // The first time this function runs, current is -1
    gsap.set(sections[currentIndex], { zIndex: 0 });
    tl.to(images[currentIndex], { yPercent: -15 * dFactor })
      .set(sections[currentIndex], { autoAlpha: 0 });
  }

  // if entering section 2, reset carousel to first item
  if (index === 1) {
    setCarouselToIndex(0);
  }

  gsap.set(sections[index], { autoAlpha: 1, zIndex: 1 });
  tl.fromTo([outerWrappers[index], innerWrappers[index]], { 
      yPercent: i => i ? -100 * dFactor : 100 * dFactor
    }, { 
      yPercent: 0 
    }, 0)
    .fromTo(images[index], { yPercent: 15 * dFactor }, { yPercent: 0 }, 0)
    .fromTo(splitHeadings[index].chars, { 
        autoAlpha: 0, 
        yPercent: 150 * dFactor
    }, {
        autoAlpha: 1,
        yPercent: 0,
        duration: 1,
        ease: "power2",
        stagger: {
          each: 0.02,
          from: "random"
        }
      }, 0.2);

  currentIndex = index;
}

/* Observer: route scroll to carousel when on section 2 */
Observer.create({
  type: "wheel,touch,pointer",
  wheelSpeed: -1,
  onDown: () => {
    if (animating) return;

    // If we're on section 2, route upward scroll to carousel (or to previous section)
    if (currentIndex === 1 && carouselItems.length) {
      if (carouselAnimating) return;
      if (carouselIndex > 0) {
        gotoCarousel(carouselIndex - 1, -1);
        return;
      }
      // if at first carousel item and scrolling up, go to previous section
    }

    gotoSection(currentIndex - 1, -1);
  },
  onUp: () => {
    if (animating) return;

    // If we're on section 2, route downward scroll to carousel (or to next section if on last item)
    if (currentIndex === 1 && carouselItems.length) {
      if (carouselAnimating) return;
      if (carouselIndex < carouselItems.length - 1) {
        gotoCarousel(carouselIndex + 1, 1);
        return;
      }
      // if at last carousel item and scrolling down, fall through to advance section
    }

    gotoSection(currentIndex + 1, 1);
  },
  tolerance: 10,
  preventDefault: true
});

gotoSection(0, 1);

/* Optional: keyboard left/right when inside carousel */
window.addEventListener('keydown', (e) => {
  if (currentIndex === 1 && carouselItems.length) {
    if (e.key === 'ArrowLeft') {
      if (!carouselAnimating && carouselIndex > 0) gotoCarousel(carouselIndex - 1, -1);
      e.preventDefault();
    } else if (e.key === 'ArrowRight') {
      if (!carouselAnimating && carouselIndex < carouselItems.length - 1) gotoCarousel(carouselIndex + 1, 1);
      e.preventDefault();
    }
  }
});
  </script>
</html>





  